# Nix configuration for dotfiles
# This file configures binary caches and experimental features
#
# Location: ~/.config/nix/nix.conf (user-level)
# For Determinate Systems Nix: settings merge with /etc/nix/nix.conf
#
# After modifying, restart nix-daemon:
#   sudo launchctl kickstart -k system/org.nixos.nix-daemon (macOS)
#   sudo systemctl restart nix-daemon (Linux)

# ==============================================================================
# EXPERIMENTAL FEATURES
# ==============================================================================
# Enable flakes and the new 'nix' command interface
# - nix-command: Modern CLI (nix build, nix run, nix flake, etc.)
# - flakes: Reproducible, hermetic builds with lock files
experimental-features = nix-command flakes

# ==============================================================================
# BINARY CACHES (SUBSTITUTERS)
# ==============================================================================
# Binary caches provide pre-built packages, avoiding slow local builds
#
# cache.nixos.org: Official Nixpkgs cache (always include!)
# nix-community.cachix.org: Community cache for:
#   - neovim nightly
#   - rust-analyzer
#   - home-manager
#   - Many other community projects
#
# Order matters: first cache that has the package wins

substituters = https://cache.nixos.org https://nix-community.cachix.org

# Public keys for verifying cached packages
# Each cache has its own signing key for security
trusted-public-keys = cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY= nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs=

# ==============================================================================
# PERFORMANCE SETTINGS
# ==============================================================================

# Use all available CPU cores for builds
# 'auto' = detect automatically, 0 = all cores for each build job
max-jobs = auto
cores = 0

# Keep build logs for debugging failed builds
keep-build-log = true

# Enable content-addressed derivations (more efficient caching)
# Reduces rebuilds when source doesn't change
# Note: This is still experimental
# ca-derivations = true

# ==============================================================================
# NETWORK SETTINGS
# ==============================================================================

# Connection timeout for binary caches (seconds)
connect-timeout = 10

# Fallback to building if cache is slow/unavailable
fallback = true

# ==============================================================================
# STORAGE SETTINGS
# ==============================================================================

# Auto-optimize store to save disk space (deduplicates files)
auto-optimise-store = true

# Minimum free disk space before Nix refuses to build (bytes)
# 1GB = 1073741824
min-free = 1073741824

# Maximum free disk space to maintain after garbage collection
# 10GB = 10737418240
max-free = 10737418240
